<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      #places {
        height: 150px;
      }
      #map {
        height: 500px;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <!--<script src="helloworld.js"></script>-->
  </head>
  <body>
    <div id="places">
      <form onsubmit="addRoute();return false;">
        Enter locations: 
        <textarea name="placesArea" id="placesArea" rows="10" cols="150">
Martin Luther King JR. Drive And & Benjamin Franklin Parkway, Philadelphia, PA 19130
3111 W Lehigh Ave, Philadelphia, PA 19132
2900 State Rd, Drexel Hill, PA 19026
Spring Garden St, Philadelphia, PA 19130
Reservoir Dr, Philadelphia, PA 19119
1 Lincoln Financial Field Way, Philadelphia, PA 19148
        </textarea>
        Return to start: <input type="checkbox" id="returnToStart">
        <input type="submit">
      </form>
    </div>
    <div id="map" class="map"></div>
    <div id="directions"></div>
    <script>
var map;
var directionsService;
var directionsDisplay;

function initMap() {
    directionsService = new google.maps.DirectionsService();
    directionsDisplay = new google.maps.DirectionsRenderer();
    map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 37.569218, lng: -77.48271525},
        zoom: 10
    });
    directionsDisplay.setMap(map);
    directionsDisplay.setPanel(document.getElementById('directions'));
}

function addRoute() {
    var addrs = document.getElementById("placesArea").value.trim().split(/\r?\n/);
    console.log(addrs);
    var waypoints = [];
    for (var addr in addrs) {
        if (addr != 0 && addr != addrs.length-1) {
            waypoints.push({location: addrs[addr], stopover: true});
        }
    }
    destination = addrs[addrs.length-1];
    if (document.getElementById("returnToStart").checked) {
        waypoints.push({location: addrs[addrs.length-1], stopover: true});
        destination = addrs[0];
    }
    console.log(waypoints);
    request = {
        origin: addrs[0],
        destination: destination,
        travelMode: "WALKING",
        unitSystem: google.maps.UnitSystem.IMPERIAL,
        waypoints: waypoints,
        optimizeWaypoints: true
    };
    directionsService.route(request, function(result, status) {
        console.log(status);
        console.log(result);
        if (status == 'OK') {
            directionsDisplay.setDirections(result);
            route = result["routes"][0];
            min_lat = route["bounds"]["f"]["b"];
            max_lat = route["bounds"]["f"]["f"];
            min_lon = route["bounds"]["b"]["b"];
            max_lon = route["bounds"]["b"]["f"];
            center_lat = min_lat + (max_lat-min_lat)/2;
            center_lon = min_lon + (max_lon-min_lon)/2;
            map.setCenter({lat:center_lat, lng: center_lon});
            order = addrs[0] + "\n";
            for (var i in route["waypoint_order"]) {
                order += addrs[route["waypoint_order"][i]+1] + "\n";
            }
            if (!order.includes("\n"+addrs[addrs.length-1]+"\n")) {
                order += addrs[addrs.length-1]+"\n";
            }
            document.getElementById("placesArea").value = order;
        }
    });
}
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDELQPc2vQNkk81bcM3f-4nOmcKuRbIV6k&callback=initMap"
    async defer></script>
  </body>
</html>